Since we use database for our application, we need to create a database service in AWS. It gives support for database by sevice **Aurora and RDS**.

In AWS Console, navigate to **Aurora and RDS --> Databases --> Create database --> Easy create
**.

Choose **PostgreSQL**, and fill in the following:

>DB instance identifier: userdb
>
>Master username: postgres
>
>Credentials management: Self managed
>
>Master password: \<create your passowrd\>

Verify if AWS CLI can now query the database:

>aws rds describe-db-instances --db-instance-identifier userdb --region ap-northeast-3

Note from the command output that the database instance can not be accessed by default:

>"PubliclyAccessible": false

Since we are going to migrate our local database to remote, we need to give permission to access it:

>aws rds modify-db-instance --db-instance-identifier userdb --publicly-accessible --apply-immediately --region ap-northeast-3

Wait for some seconds, and then check its status:

>aws rds describe-db-instances --db-instance-identifier userdb --region ap-northeast-3 --query 'DBInstances[0].[PubliclyAccessible]'

Make sure it will show as **true**.

In addition, we need to create a Security Group for accessing database. Navigate to **EC2 --> Security Groups --> Create security group**. Fill in the following:

>Security group name: DB_SG
>
>Description: security rules for database
>
>VPC: my-vpc

Add one inbound rules:
>Type: PostgreSQL
>
>Source: 0.0.0.0/0
>
>Description: allow access to database from public

To apply this Security Group to the database, navigate back to **Aurora and RDS --> Databases**, select **userdb** and click **Modify**.

Scroll to **Connectivity** section, for **Security group**, remove the default one and choose **DB_SG**.

Click **Continue** and select **Apply immediately**.

Now verify if we can access the remote database:

>DB_URL=$(aws rds describe-db-instances --db-instance-identifier userdb --region ap-northeast-3 --query 'DBInstances[0].[Endpoint.Address]' --output text)

>psql -h $DB_URL -U postgres -d postgres -c "SELECT version();"

Input password, and make sure version info will be displayed.

Before migration, first create a database with the same name as the local one:
>psql -h $DB_URL -U postgres -d postgres -c "CREATE DATABASE userdb;"

Dump local database table **users** to a file:
>pg_dump -U postgres -h localhost -d userdb > dump.sql

Migrate it to remote:
>psql -h $DB_URL -U postgres -d userdb < dump.sql

Verify the remote table:
>psql -h $DB_URL -U postgres -d userdb -c "SELECT * FROM users;"

We should see it has the same user records as the local table.

One more thing to do is to store the remote database password. Navigate to **Secrets Manager --> Store a new secret**. Fill in the following:

>Secret type: Credentials for Amazon RDS database
>
>Credentials: enter username and password for the database we created.
>
>Database: select **userdb**.
>
>Secret name: my-db-secret

We'll use this secret in later tutorials when docker application needs to access the database.

Please note, we have created a Security Group to allow access to the database from local host. Security Group is the essential strategy for security consideration of every AWS service. Its inbound rules define by which way others can access to this service and its outbound rules define what other sevices this service can access. We'll add other Security Groups in later tutorials for each service that will be used.